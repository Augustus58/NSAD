\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

\newcommand{\code}[1]{\texttt{#1}}

\begin{document}

\title{Xamarin.Forms Development Fundamentals}

\author{
  \IEEEauthorblockN{
    Aku Silvennoinen
  }
  \IEEEauthorblockA{
    \textit{Department of Computer Science} \\
    \textit{University of Helsinki}\\
    Helsinki, Finland \\
    aku.silvennoinen@helsinki.fi
  }
}

\maketitle

\begin{abstract}
  todo
\end{abstract}

\begin{IEEEkeywords}
  Xamarin.Forms, MVVM
\end{IEEEkeywords}

\section{Introduction}

Targeting multiple mobile platforms in software development is a challenge because of different user-interface paradigms, different development environments, different programming interfaces, and different programming languages. At the moment, the most relevant mobile platforms are Android and iOS. One of the main differences between user-interface paradigms for Android and iOS is the concept of the back button. In Android, there is the back button at the right bottom corner, no matter which view is active. In iOS there is no such button but going back can happen by swiping the screen, pressing a button in a user interface or pressing the home button. Android development happens usually in Android Studio~\cite{androidstudio} environment whereas iOS development happens in Xcode environment~\cite{xcode}. Programming interfaces are different. For example, toggling a Boolean value in Android happens by using a ``widget'' called \texttt{Switch} whereas in iOS it happens by using a ``view'' called \texttt{UISwitch}. Android development is done traditionally with Java programming language whereas iOS development is done traditionally in Objective-C.

A trivial, but laborious strategy is to just develop distinct versions of an application for all platforms. An advantage of this strategy is that it is much easier to find developers for native Android and iOS development. A disadvantage is that an application should be developed as many times as there are target platforms. A lot of designing work can be merged though.

Another strategy is the cross platform development, where possibly all lines of written code are shared between target platforms. Available cross platform mobile development solutions are for example Apache~Cordova~\cite{cordova}, React~Native~\cite{react}, and Xamarin.Forms~\cite{xamarin.forms}. The last is discussed in this paper. The so called Progressive Web App development is also a cross platform approach~\cite{7972716}.

Xamarin is a San Francisco -based company founded in 2011 and owned by Microsoft. The main product of the Xamarin company is Xamarin Platform and Xamarin.Forms is a part of it. Xamarin is founded by the engineers who created Mono, Mono for Android and MonoTouch. Mono is a cross platform .NET~Framework~\cite{mono}. ``.NET is a free, cross-platform, open source developer platform for building many different types of applications.''~\cite{dotnet}. Mono for Android is the ancestor of Xamarin.Android -- a .NET library which implements the Android API. Finally, MonoTouch is the ancestor of Xamarin.iOS -- a .NET library which implements the iOS API.

Xamarin.Forms uses C\#~\cite{csharp} as the programming language, Visual~Studio~\cite{vs} or Visual~Studio~for~Mac as the development environment, and .NET~Framework class library for core functionalities, such as networking and JSON reading and writing. C\# is a multi-paradigm programming language which is closely associated to the .NET~Framework. C\# has had language level support right from the beginning for properties~\cite{properties} and events~\cite{events} which are useful in programming graphical user interfaces. Additionally C\# supports asynchronous programming~\cite{asyncro}.

Xamarin.Forms uses the MVVM-architecture (Model-View-ViewModel) for dividing views and business logic. The Model handles the underlying data. The View handles the user interface. And finally, the ViewModel handles interaction between the Model and the View.

\subsection*{Research Goals}

The main research goal of this paper is to answer the question:

\emph{What should a developer know about Xamarin.Forms in order to do professional mobile development with it?}

\section{Fundamentals of Xamarin.Forms}

Sources for this section are~\cite{xamarin},~\cite{xamarin2},~and~\cite{xamarin3}. 

In Xamarin.Forms all code is written in C\#. XML is used widely for configuration files and defining views. Mobile applications made with Xamarin.Forms are native mobile applications. The question is that how files written in XML and C\# are compiled to binary files runnable on Android or iOS. Answering that question is started by discussing how a Xamarin.Forms application is compiled from C\# and XML to a native binary.

\subsection{From C\# and XML to a Native Binary}

Xamarin.Forms is actually a cross-platform User Interface (UI) framework. Xamarin.Forms can render its UI components to native controls on each platform. In Xamarin.Forms, the whole application can be written in C\# and XML.

At the core of Xamarin is to present native APIs idiomatically to C\#. For instance native APIs of Android or iOS. Xamarin library for iOS bindings is Xamarin.iOS and respectively for Android it is Xamarin.Android.

For instance Xamarin.iOS can be used to build a native iOS applications using C\# and XML. Respectively Xamarin.Android can be used to build native Android applications. Xamarin.Forms is not needed for building those native mobile applications. It \emph{can be used} to define UI for a multiplatform mobile software project.

The process is different for iOS and Android. iOS is discussed first.

\subsubsection{iOS}

In the compilation process Xamarin.Forms UI parts of the application are converted to Xamarin.iOS compatible code. Conversion is done by Xamarin.Forms.Platform.iOS library. Non UI components are more likely copied beside converted UI components. The result is code which can utilise iOS binding libraries offered by Xamarin.iOS.

Xamarin.iOS then compiles the project to Intermediate Language (IL). Xamarin.iOS contains an extended subset of desktop .NET assemblies. IL code contains needed .NET assemblies. Finally, IL is compiled to iOS binary by Xcode~\cite{xcode}. Xamarin.iOS can produce Xcode compatible IL code because it contains bindings to native classes for iOS development. Xamarin.iOS utilises Mono Ahead Of Time (AOT) compilation~\cite{mono_aot} when it compiles to the IL.

\subsubsection{Android}

Android applications run inside the Android Runtime (ART). Applications compiled from an Xamarin.Forms project to Android are not running inside ART, but inside Mono Common Language Runtime (CLR) \emph{and} ART. Mono CLR contains implementation of the .NET runtime libraries and is also an virtual machine.

The question is that how an application can run inside two virtual machines? The answer is concept called \emph{peer objects} and a Java framework called Java Native Interface (JNI). JNI is a framework which makes possible to call or be called by Java code running inside a Java Virtual Machine (JVM). Processes running inside ART and Mono CLR are communicating with JNI calls. The concept of peer objects is in practice two corresponding objects residing in the two virtual machines communicating to each other with JNI calls.

Xamarin.Android contains Android binding libraries. Classes in the libraries correspond to the Java classes in the Android framework. Binding classes contain wrapper methods for calling corresponding methods in Java classes. Binding classes are called Managed Callable Wrappers (MCW).

When an Xamarin.Forms application is compiled to Android it is first converted to Xamarin.Android. Conversion is done by Xamarin.Forms.Platform.Android library. It converses abstract Xamarin.Forms UI components to Android compatible binding classes. Other components are more likely copied beside converted UI components. The resulted code can be interpreted by Mono CLR and objects of classes in the code will have peer objects inside ART.

ART and Mono CLR both run on top of Android Linux kernel. Mono CLR contains of the .NET runtime libraries, so Xamarin.Forms applications can utilise .NET runtime components \emph{and} libraries offered by Android framework.

\section{Xamarin.Forms User Interface Abstraction}

Xamarin.Forms supports Extensible Application Markup Language (XAML) developed at Microsoft. XAML is XML-based general-purpose markup language. In can be used for instantiating and initialising objects. XAML is used in Xamarin.Forms to define abstract UI components.

For instance a \emph{Label} for showing a paragraph can be defined with XAML by writing \code{<Label Text="Green" VerticalOptions="Center" />}. Labels or other elements can be stacked horizontally or vertically using the \emph{StackLayout}. Elements to be stacked are just placed inside StackLayout tags: \code{<StackLayout Padding="10,0"><Label Text="First Label" VerticalOptions="CenterAndExpand" HorizontalOptions="Center" /><Label Text="Second Label" VerticalOptions="CenterAndExpand" HorizontalOptions="Center" /></StackLayout>}.

XAML elements in Xamarin.Forms have corresponding classes representing abstract UI elements. Writing a XAML-file is just initialising and defining objects of those classes. Thereby one does not /emph{have to} use XAML, but using it might help in designing user interfaces.

\section{Xamarin.Forms and Web Views}

Creating modern user interfaces in mobile with Xamarin.Forms is generally slower than with for instance HTML5~\cite{html5} with Bootstrap UI library~\cite{bootstrap}. Reasons for that are discussed in the following. It is much easier to hire developers with decent web UI skills and knowledge than skills needed for Xamarin.Forms. Skills and knowledge needed for Xamarin.Forms development are for example XML (XAML), C\#, and MVVM-architecture. Xamarin.Forms might be easier for a developer who is experienced desktop UI developer \emph{with Microsoft technologies} using XAML (for example Windows Presentation Foundation (WPF)~\cite{wpf}).

Another challenge is that Xamarin.Forms is an UI abstraction for multiple mobile platforms -- it is not an foundation for flexible UI design. Xamarin.Forms UI elements are not as flexible and configurable as UI elements in web development. Customers are accustomed to see good looking web UIs. At the same time an mobile application is in many cases an important part of public image of a customer. Therefore using Xamarin.Forms itself for creating UIs for demanding customers is not a good idea. It is possible to create somehow decent UIs with Xamarin.Forms, but the process is too resource demanding.

One solution for the problem might be a hybrid solution with Xamarin.Forms and some web technologies. With Xamarin.Forms (and Xamarin.Android and Xamarin.iOS) it is possible to define a frame for a mobile UI -- for Android and iOS at the same time. The UI frame can be reused and therefore it is acceptable to use more resources for building it. If the frame contains \emph{a wrapper} for web contents, more complicated views can be built with web technologies. Some technical details can be found from~\cite{hwb}.

\subsection{Bundling Web Content Within an Application}

Whether to bundle web contents within an application or to serve contents from a web server depends on delay and reliability requirements.

To minimise delays, web resources can be bundled within an application. Dynamic data can be passed to the web view from the application or it can be queried from an web API with an API token. Bundled web content could be for instance a light weight JavaScript application which gets data from an web API.

Bundled web contents are not vulnerable to network problems. Of course possible dynamic data are (if not cached to a device).

\subsection{Passing Data to a Web View}

Data to a web view can be passed by running a JavaScript code inside the web view from the surrounding application. Use cases for data to be passed are an API token or JSON data~\cite{json}.

\subsection{Calling Methods In The Surrounding Application From An JavaScript Code}

As presented in~\cite{hwb}, methods implemented in C# can be called from an JavaScript code running inside a web view. That is very useful for example if a web view is the main view of an application -- non web view can be activated by pressing a button on the web view.

\nocite{xamarin}
\nocite{xamarin2}
\nocite{xamarin3}
\bibliographystyle{./IEEEtran}
\bibliography{bibliography}

\end{document}
